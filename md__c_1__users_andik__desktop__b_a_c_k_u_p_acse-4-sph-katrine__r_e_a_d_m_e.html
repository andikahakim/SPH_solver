<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SPH: ACSE-4 Project 3: Smooth Particle Hydrodynamics Solver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SPH
   &#160;<span id="projectnumber">Version 0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__c_1__users_andik__desktop__b_a_c_k_u_p_acse-4-sph-katrine__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ACSE-4 Project 3: Smooth Particle Hydrodynamics Solver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3><a class="anchor" id="autotoc_md1"></a>
Team Katrine: Andika Hakim, Qingyang Li, Helen Situ, Chao-Lun Liu, Chen Qian, Nandong Yan</h3>
<p><a href="https://en.wikipedia.org/wiki/Smoothed-particle_hydrodynamics">Smoothed Particle Hydrodynamics</a> (SPH) is a meshless method for solving the Navier-Stokes equation, in which fluid properties are stored on Lagrangian fluid particles (i.e. on particles which move with the fluid flow). The particles interact to generate values across the entire fluid domain through continuous smoothing kernels.</p>
<p>As the SPH method is meshless and Lagrangian, it is ideal for solving problems involving fluid flow with interfaces and free surfaces. This tool implements the SPH method in C++ to solve wave generation in a lock-release/dam-break problem.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Compilation/Installation Guide</h1>
<p>To install the module <code>acse-4-sph-katrine </code> clone the respository to your computer with `` git clone <a href="https://github.com/acse-2019/acse-4-sph-katrine.git">https://github.com/acse-2019/acse-4-sph-katrine.git</a> `` Then change directory into the root of the repo you just cloned `` cd acse-4-sph-katrine `` and the run </p><div class="fragment"><div class="line">make</div>
</div><!-- fragment --><p>The make command will automatically fetch the <code>Makefile</code> instructions in the data and execute the following scripts </p><div class="fragment"><div class="line">g++ -o build/SPH_2D.o -c src/SPH_2D.cpp -Wall -std=c++17 -fopenmp -fpermissive -Iincludes</div>
<div class="line">g++ -o build/SPH_Snippet.o -c src/SPH_Snippet.cpp -Wall -std=c++17 -fopenmp -fpermissive -Iincludes</div>
<div class="line">g++ -o build/file_writer.o -c src/file_writer.cpp -Wall -std=c++17 -fopenmp -fpermissive -Iincludes</div>
<div class="line">g++ -o bin/SPH_2D build/SPH_2D.o build/SPH_Snippet.o build/file_writer.o</div>
</div><!-- fragment --><p>If users want to run the repo on command line, you can run below instruction, example:</p>
<div class="fragment"><div class="line">g++ -Xpreprocessor -fopenmp -lomp -o main SPH_FE_Snippet.cpp SPH_2D.cpp file_writer.cpp -std=c++17</div>
<div class="line"> </div>
<div class="line">./main</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
User instructions</h1>
<p>Save in the file <code>/src</code> and <code>/icnludes</code></p>
<p>&ndash; <a href="SPH_2D.h">SPH_Snippet.cpp</a> &ndash; <a href="SPH_2D.h">SPH_FE_Snippet.cpp</a> &ndash; <a href="SPH_2D.h">SPH_PC_Snippet.cpp</a> &ndash; <a href="SPH_2D.h">SPH_2D.cpp</a> &ndash; <a href="file_writer.h">file_writer.cpp</a></p>
<p>to your code directory and inform it as a header in your file.</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;SPH_2D.h&quot;</div>
<div class="line">#include &quot;file_writer.h&quot;</div>
<div class="line">#include &lt;string&gt;</div>
<div class="line">#include &lt;iomanip&gt;</div>
<div class="line">#include &lt;cmath&gt;</div>
<div class="line">#include &lt;complex&gt;</div>
<div class="line">#include &lt;math.h&gt;</div>
<div class="line">#include &lt;fstream&gt;</div>
<div class="line">#include &lt;vector&gt;</div>
<div class="line">#include &lt;omp.h&gt;</div>
<div class="line">#define _USE_MATH_DEFINES</div>
</div><!-- fragment --><p>When dealing with a main, which will call write_file function:</p>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">#include &quot;file_writer.h&quot;</div>
<div class="line">#include &lt;string&gt;</div>
<div class="line">#include &lt;fstream&gt;</div>
<div class="line">#include &lt;vector&gt;</div>
</div><!-- fragment --><p>Developer users with experience in the fields of C ++ and SPH will be able to take our code and build on top of it. For these people, we encourage you to read through the code and understand how it works, but to get you started, you can use the following lines of code in a C ++ script to initialize and run your first simulation:</p>
<h2><a class="anchor" id="autotoc_md4"></a>
OpenMP  :</h2>
<p>OpenMP consists of a set of compiler #pragmas that control how the program works. The pragmas are designed so that even if the compiler does not support them, the program will still yield correct behavior, but without any parallelism.</p>
<p>C++</p>
<p>STL is not thread-safe. If you use STL containers in a parallel context, you must exclude concurrent access using locks or other mechanisms. Const-access is usually fine, as long as non-const access does not occur at the same time.</p>
<p>Exceptions may not be thrown and caught across omp constructs. That is, if a code inside an <code>omp for</code> throws an exception, the exception must be caught before the end of the loop iteration; and an exception thrown inside a parallel section must be caught by the same thread before the end of the <code>parallel</code>section.</p>
<p>GCC</p>
<p><code>fork()</code> is troublematic when used together with OpenMP. See the chapter "OpenMP and fork()" above for details.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Optional arguments  :</h2>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line">/* Initialising timestepping */</div>
<div class="line">double dt = 0.1 * domain.h / domain.c0; // first timestep</div>
<div class="line">double tmax = 30.0; // total simulation time</div>
<div class="line">double time = 0.; // current time</div>
<div class="line"> </div>
<div class="line">int update_freq = 10; // smoothing density</div>
<div class="line">double file_time = 0.; // times to output files, gets updated in loop</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Create boundary &amp; Set the grid points :</h2>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line"> </div>
<div class="line">SPH_main domain;</div>
<div class="line"> </div>
<div class="line">//Set simulation parameters</div>
<div class="line">domain.set_values();</div>
<div class="line">//initialise simulation grid</div>
<div class="line">domain.initialise_grid();</div>
<div class="line">//places initial points - will need to be modified to include boundary points and the specifics of where the fluid is in the domain</div>
<div class="line">domain.place_points(domain.min_x, domain.max_x, &quot;Bubble&quot;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
SPH_FE_Snippest  :</h2>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line"> </div>
<div class="line">/* run forward euler simulation */</div>
<div class="line">int step = 0;</div>
<div class="line">while (time &lt;= tmax)</div>
<div class="line">{</div>
<div class="line">    domain.allocate_to_grid();</div>
<div class="line"> </div>
<div class="line">    // Smooth density</div>
<div class="line">    if (step % update_freq == 0)</div>
<div class="line">    {</div>
<div class="line">        #pragma omp parallel for schedule (guided)    </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            domain.smooth(&amp;domain.particle_list[i], dt);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // Iterate through neighbors and fill in information for time-stepping, for every particle</div>
<div class="line">    #pragma omp parallel for schedule (guided)    </div>
<div class="line">    // Parallelize the loop</div>
<div class="line">    for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">        domain.neighbour_iterate(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">    // Update values of every particle</div>
<div class="line">    #pragma omp parallel for schedule (guided)    </div>
<div class="line">    // Parallelize the loop</div>
<div class="line">    for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">        domain.forward_euler(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">    // Output VTP file every 0.1s</div>
<div class="line">    if (time &gt;= file_time)</div>
<div class="line">    {</div>
<div class="line">        string fname = &quot;example_&quot; + to_string(step) + &quot;.vtp&quot;;</div>
<div class="line">        write_file(fname.c_str(), &amp;domain.particle_list);</div>
<div class="line"> </div>
<div class="line">        file_time += 0.1;</div>
<div class="line">    }</div>
<div class="line">    time += dt;</div>
<div class="line">    step++;</div>
<div class="line">    // Update new timestep</div>
<div class="line">    domain.get_dt();</div>
<div class="line">    dt = domain.dt;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
SPH_PC_Snippest  :</h2>
<div class="fragment"><div class="line"> {C++}</div>
<div class="line"> </div>
<div class="line">/* run predictor corrector two phase simulation */</div>
<div class="line">int step = 0;</div>
<div class="line">while (time &lt;= tmax)</div>
<div class="line">{</div>
<div class="line">    domain.allocate_to_grid();</div>
<div class="line"> </div>
<div class="line">    // Smooth density</div>
<div class="line">    if (step % update_freq == 0)</div>
<div class="line">    {</div>
<div class="line">        #pragma omp parallel for schedule (guided)        </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            domain.smooth(&amp;domain.particle_list[i], dt);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        // Iterate through neighbors and fill in information for time-stepping, for every particle</div>
<div class="line">        #pragma omp parallel for schedule (guided)        </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            domain.neighbour_iterate(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">        // Update values of every particle</div>
<div class="line">        #pragma omp parallel for schedule (guided)        </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            //domain.forward_euler(&amp;domain.particle_list[i], dt);</div>
<div class="line">            domain.predictor_corrector_half(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">        domain.allocate_to_grid();</div>
<div class="line"> </div>
<div class="line">        // Iterate through neighbors and fill in information for time-stepping, for every particle</div>
<div class="line">        #pragma omp parallel for schedule (guided)        </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            domain.neighbour_iterate(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">        // Update values of every particle</div>
<div class="line">        #pragma omp parallel for schedule (guided)        </div>
<div class="line">        // Parallelize the loop</div>
<div class="line">        for (int i = 0; i &lt; domain.particle_list.size(); i++)</div>
<div class="line">            domain.predictor_corrector_full(&amp;domain.particle_list[i], dt);</div>
<div class="line"> </div>
<div class="line">        time += dt;</div>
<div class="line">        step++;</div>
<div class="line"> </div>
<div class="line">        // Output VTP file every 0.1s</div>
<div class="line">        if (time &gt;= file_time)</div>
<div class="line">        {</div>
<div class="line">            string fname = &quot;vtp/example_&quot; + to_string(step) + &quot;.vtp&quot;;</div>
<div class="line">            write_file(fname.c_str(), &amp;domain.particle_list);</div>
<div class="line"> </div>
<div class="line">            file_time += 0.1;</div>
<div class="line">        }</div>
<div class="line">        // Update new timestep</div>
<div class="line">        domain.get_dt();</div>
<div class="line">        dt = domain.dt;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Documentation</h1>
<div class="fragment"><div class="line">Information on the implementation and functions included are in the /documentation/html ``index.html`` document.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Structure</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
The SPH_2D module:</h2>
<p>The sph_2D module is mainly used for generating a domain and dynamic particles (and their properties) in the meshed domain.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
The  SPH_main class:</h2>
<p>The <a class="el" href="class_s_p_h__main.html" title="Class object that contain domain / system information.">SPH_main</a> class, within "SPH_2D.cpp" and "SPH_2D.h" used to initialise a single object of the main SPH type (a initial domain containing boundaries and liquid particles) <br  />
</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Class methods:</h3>
<h4><a class="anchor" id="autotoc_md14"></a>
&lt;strong&gt;SPH_main():&lt;/strong&gt;</h4>
<ul>
<li>This is the class object that creates the domain onto which the particles will be placed</li>
</ul>
<p><b>set_values():</b></p>
<ul>
<li>This method sets the simulation domain parameters.</li>
<li>Domain reference values such as the fluid speed of sound, the domain reference density and the solution end time are given .<br  />
</li>
</ul>
<p><b>initialise_grid():</b></p>
<ul>
<li>Initialises a simulation grid and calculates the size of the array needed for an attribute called search_grid[]. search_grid[] is used later on to calculate the contributions of neighbouring particles in neighbour_iterate().</li>
</ul>
<p><b>place_points(min,  max, geometry):</b></p>
<ul>
<li>within the initialised grid, a particle at every increment of dx is created using the <a class="el" href="class_s_p_h__particle.html" title="Class object that contain particle information.">SPH_particle()</a> class. The particles are assigned an index relative to the search grid and then appended into a list called particle_list[].</li>
</ul>
<p><b>allocate_to_grid()</b></p>
<ul>
<li>particles are assigned to a search grid using the index created earlier.</li>
</ul>
<p><b>neighbour_iterate(part, dt)</b></p>
<ul>
<li>this function iterates through every particle in the domain. It quantifies the contributions of the neighbours by using it's search_grid index and then approximates the derivatives in the navier-stokes equation using a smoothing kernel</li>
</ul>
<p><b>forward_euler(part, dt)</b></p>
<ul>
<li>this function time steps the particles in the particle list. At every time increment, neighbour_iterate and update_values are used to update the particle parameters for the next time increment</li>
<li>at the end of the forward_wrapper(), the each particle_list at prespecified time increment is combined and then saved into a file called 'State.npy'.</li>
</ul>
<p><b>predictor_corrector_half(part, dt)</b> <b>predictor_corrector_full(part, dt)</b></p>
<ul>
<li>The above functions allow a particle‚Äôs acceleration and rate of change of density to be calculated as a function of its neighbour‚Äôs positions, velocities and densities/pressures. We now need to be able to update the particle‚Äôs position, velocity and density, with the updated density being used to calculate a new pressure. To save complexity we will be doing this explicitly.</li>
<li>The added complexity with the predictor-corrector scheme is that 2 values for each of the variables need to be stored (the initial value and the half-step value) and the neighbour searching needs to be based on the appropriate ùê± values.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
The SPH_particle Class:</h2>
<p>The <a class="el" href="class_s_p_h__particle.html" title="Class object that contain particle information.">SPH_particle</a> class, within "SPH_2D.h" is a class which creates an object of a single particle with attributes. The class contains the attributes including position (x), velocity (v), acceleration (a), density (rho), pressure (P) and the instantaneous change in density (D).</p>
<p>Within the <a class="el" href="class_s_p_h__particle.html" title="Class object that contain particle information.">SPH_particle</a> class are class functions:</p>
<p><b>calc_index()</b></p>
<ul>
<li>this function gives assigns a list number to the current particle. This list number is used to allocate the particle to the search grid</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Testing</h1>
<p>The tool includes tests, which you can use to check its operation on your system. With the code compiled, these can be run with</p>
<div class="fragment"><div class="line">python run_tests.py</div>
</div><!-- fragment --><p>Testing is performed using <code>run_tests.py</code>. Four sanity checks are implemented:</p>
<ul>
<li>test_v() : Test that velocity magnitude is lower than the speed of sound</li>
<li>test_rho() : Test that density value is reasonable</li>
<li>test_position() : Test that particle is not far outside simulation domain</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Contributors</h1>
<ul>
<li><a href="https://www.imperial.ac.uk/people/s.neethling"><b>Professor Stephen Neethling</b></a></li>
<li><a href="https://github.com/acse-2019/acse-4-sph-katrine"><b>Kartrine group</b></a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
